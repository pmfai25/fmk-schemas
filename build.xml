<?xml version="1.0"?>
<!-- the project element's name attribute will be used in the name of the module's jar file -->
<project name="medicinkortet-schema" default="all" basedir="." xmlns:ivy="antlib:fr.jayasoft.ivy.ant" >

	<property name="ivy.checksums" value=""/>
	
	<property file="build.properties"/>
	<property name="trifork-common" value="${basedir}/../trifork-common"/>
	<import file="${trifork-common}/etc/build-common.xml"/>
    
	
    <path id="classpath">
        <fileset dir="lib/build">
            <include name="**/*.jar"/>
        </fileset>
        <pathelement location="${build.dir}"/>
        <pathelement location="${resources.dir}"/>
        <pathelement location="${externalresources.dir}"/>
    </path>

	<condition property="os.family" value="mac">
        <os family="mac"/>
    </condition>
    <condition property="os.family" value="windows">
        <os family="windows"/>
    </condition>
	<condition property="os.family" value="linux">
        <os family="unix"/>
	</condition>
	
	<target name="publish" depends="clean, all, publish-from-jenkins"/>
		
	<target name="all" depends="resolve-build, organize-schemas,generate-namespace-oracle"/>
	
    <target name="generate-namespace-oracle" depends="compile">
        <java classpathref="classpath" failonerror="true"
        	classname="dk.medicinkortet.notproduktion.namespaceoracle.NamespaceOracleGenerator"/>
    </target>	
	
	<target name="organize-schemas" depends="compile" >
		<mkdir dir="target/wsdl" />

			<java classname="dk.medicinkortet.xmlschema.SchemaLoader" fork="true" failonerror="true" jvmargs="-Xmx1024m">
				<classpath>
					<path location="${build.dir}"/>
					<fileset dir="lib/build" excludes="*gwt*"/>
				</classpath>
				<sysproperty key="VersionDate" value="2012_06_01"/>
				<sysproperty key="WsdlName" value="EffectuationOrdering"/>
			</java>

		<zip destfile="target/wsdl/EffectuationOrdering_2012_06_01-collection.zip" 
				  basedir="target/wsdl/EffectuationOrdering_2012_06_01"/>
		
		<java classname="dk.medicinkortet.xmlschema.SchemaLoader" fork="true" failonerror="true" jvmargs="-Xmx1024m">
			<classpath>
				<path location="${build.dir}"/>
				<fileset dir="lib/build" excludes="*gwt*"/>
			</classpath>
			<sysproperty key="VersionDate" value="2012_06_01"/>
			<sysproperty key="WsdlName" value="PatientOrganisationRelation"/>
		</java>
		<zip destfile="target/wsdl/PatientOrganisationRelation_2012_06_01-collection.zip" 
			  basedir="target/wsdl/PatientOrganisationRelation_2012_06_01"/>
		
        <java classname="dk.medicinkortet.xmlschema.SchemaLoader" fork="true" failonerror="true" jvmargs="-Xmx1024m">
            <classpath>
                <path location="${build.dir}"/>
                <fileset dir="lib/build" excludes="*gwt*"/>
            </classpath>
            <sysproperty key="VersionDate" value="2012_06_01"/>
            <sysproperty key="WsdlName" value="MedicineCard"/>
        </java>
		<zip destfile="target/wsdl/MedicineCard_2012_06_01-collection.zip" basedir="target/wsdl/MedicineCard_2012_06_01"/>

		<java classname="dk.medicinkortet.xmlschema.SchemaLoader" fork="true" failonerror="true" jvmargs="-Xmx1024m">
			<classpath>
				<path location="${build.dir}"/>
				<fileset dir="lib/build" excludes="*gwt*"/>
			</classpath>
			<sysproperty key="VersionDate" value="2012_01_01"/>
            <sysproperty key="WsdlName" value="MedicineCard"/>
		</java>
		<zip destfile="target/wsdl/MedicineCard_2012_01_01-collection.zip" basedir="target/wsdl/MedicineCard_2012_01_01"/>

		<java classname="dk.medicinkortet.xmlschema.SchemaLoader" fork="true" failonerror="true" jvmargs="-Xmx1024m">
			<classpath>
				<path location="${build.dir}"/>
				<fileset dir="lib/build" excludes="*gwt*"/>
			</classpath>
			<sysproperty key="VersionDate" value="2012_01_01_126Only"/>
            <sysproperty key="WsdlName" value="MedicineCard"/>
		</java>
		<zip destfile="target/wsdl/MedicineCard_2012_01_01_126Only-collection.zip" basedir="target/wsdl/MedicineCard_2012_01_01"/>

		<java classname="dk.medicinkortet.xmlschema.SchemaLoader" fork="true" failonerror="true" jvmargs="-Xmx1024m">
			<classpath>
				<path location="${build.dir}"/>
				<fileset dir="lib/build" excludes="*gwt*"/>
			</classpath>
			<sysproperty key="VersionDate" value="2011_01_01"/>
            <sysproperty key="WsdlName" value="MedicineCard"/>
		</java>
		<zip destfile="target/wsdl/MedicineCard_2011_01_01-collection.zip" basedir="target/wsdl/MedicineCard_2011_01_01"/>

		<java classname="dk.medicinkortet.xmlschema.SchemaLoader" fork="true" failonerror="true" jvmargs="-Xmx1024m">
			<classpath>
				<path location="${build.dir}"/>
				<fileset dir="lib/build" excludes="*gwt*"/>
			</classpath>
			<sysproperty key="VersionDate" value="2009_01_01"/>
            <sysproperty key="WsdlName" value="MedicineCard"/>
		</java>
		<zip destfile="target/wsdl/MedicineCard_2009_01_01-collection.zip" basedir="target/wsdl/MedicineCard_2009_01_01"/>
		
		<copy todir="target">
			<fileset dir="target/gensrc/META-INF" includes="schemas/**"/>
		</copy>
		<copy todir="target/wsdl">
			<fileset dir="etc/wsdl" includes="PEMAuditLog_*.wsdl"/>
		</copy>
		<copy todir="target/schemas">
			<fileset dir="etc/schemas">
				<exclude name="sdsd"/>
			</fileset>
		</copy>
        <zip destfile="target/fmk-schema.zip"
             basedir="target"
             includes="schemas/**, wsdl/**" />
	</target>

    <target name="clean">
        <delete dir="build"/>
        <delete dir="target"/>
        <delete dir="gensrc"/>
        <delete dir="lib/build"/>
        <delete dir="lib/test"/>
    </target>

</project>
